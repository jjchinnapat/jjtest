name: check_build_push

on:
  push:
    branches: [ master ]
  pull_request:
    branches: [ master ]

jobs:
  push :
    runs-on: self-hosted
    steps:
    # - name: Get changed files
    #   id: changed-files
    #   uses: tj-actions/changed-files@v2.1
    # - name: Dockerfile has changed rebuild and test
    #   if: contains(steps.changed-files.outputs.modified_files, 'Dockerfile')
    #   run: docker build -f /home/jjchin/actions-runner/test/jjtest/jjtest/update-imageflutterpubget/Dockerfile \
    #   -t imageflutterpubget .

    # - name: Verify Changed pubspec.yaml files
    #   uses: tj-actions/verify-changed-files@v8
    #   id: verify_changed_files
    #   with:
    #     files: |
    #       pubspec.yaml
    # - name: pubspec.yaml changed
    #   if: steps.verify_changed_files.outputs.files_changed == 'true'
    #   run: | 
    #     docker build -f /home/jjchin/actions-runner/test/jjtest/jjtest/update-imageflutterpubget/Dockerfile -t imageflutterpubget .

    # - name: build_push
    - uses: actions/checkout@v2
    - run: |
        docker build -f /home/jjchin/actions-runner/test/jjtest/jjtest/Dockerfile \
        -t ghcr.io/jjchinnapat/imageflutterweb:latest --build-arg GIT_PAT=${{ secrets.GIT_PAT }} .
        echo ${{ secrets.GIT_PAT }} | docker login ghcr.io -u jjchinnapat --password-stdin
        docker push ghcr.io/jjchinnapat/imageflutterweb:latest
# cd /home/jjchin